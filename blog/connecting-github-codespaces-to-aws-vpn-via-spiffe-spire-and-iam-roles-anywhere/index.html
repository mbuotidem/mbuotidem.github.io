<!DOCTYPE html>
<html lang="en" >

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="base" content="https://misaac.me">

    
    <title>Isaac on DevSecOps • Connecting GitHub Codespaces to AWS VPN via SPIFFE/SPIRE & IAM Roles Anywhere</title>

    
    
    

    
    

    
    
    
        <link rel="stylesheet" href="https://misaac.me/inter_subset_en.css?h=d8cf4ad058d6c3a4015b">
    

    
        <link rel="stylesheet" href="https://misaac.me/main.css?h=f8b119c70beffb77ac87" />

    <meta name="color-scheme" content="light dark" />
        <meta name="description" content="Learn how to authenticate your GitHub Codespace to AWS VPN using SPIRE-issued X.509 certificates and AWS IAM Roles Anywhere" />
        <meta property="og:description" content="Learn how to authenticate your GitHub Codespace to AWS VPN using SPIRE-issued X.509 certificates and AWS IAM Roles Anywhere" />

    
        <meta name="robots" content="index, nofollow" />
    

    <meta property="og:title" content="Connecting GitHub Codespaces to AWS VPN via SPIFFE/SPIRE & IAM Roles Anywhere" />
    <meta property="og:type" content="article" />

    
<meta property="og:locale" content="en_GB" />

    <meta property="og:url" content="https:&#x2F;&#x2F;misaac.me&#x2F;blog&#x2F;connecting-github-codespaces-to-aws-vpn-via-spiffe-spire-and-iam-roles-anywhere&#x2F;" /><meta property="og:site_name" content="Isaac on DevSecOps"><meta http-equiv="Content-Security-Policy"
content="default-src 'self';font-src &#x27;self&#x27; data:;img-src &#x27;self&#x27; https:&#x2F;&#x2F;* data:;media-src &#x27;self&#x27;;style-src &#x27;self&#x27; https:&#x2F;&#x2F;emgithub.com &#x27;unsafe-inline&#x27; https:&#x2F;&#x2F;emgithub.misaac.me &#x27;unsafe-inline&#x27; https:&#x2F;&#x2F;gist.github.com &#x27;unsafe-inline&#x27; https:&#x2F;&#x2F;github.githubassets.com &#x27;unsafe-inline&#x27;;frame-src player.vimeo.com https:&#x2F;&#x2F;www.youtube-nocookie.com https:&#x2F;&#x2F;emgithub.com https:&#x2F;&#x2F;emgithub.misaac.me;connect-src 'self';script-src 'self' 'self' https://gist.github.com">

        <noscript><link rel="stylesheet" href="https://misaac.me/no_js.css"/></noscript>
        <script type="text/javascript" src="https://misaac.me/js/initializeTheme.min.js"></script>
        <script defer src="https://misaac.me/js/themeSwitcher.min.js"></script></head>


<body class="use-sans-serif">
    <header>
    <nav class="navbar">
        <div class="nav-title">
            <a class="home-title" href="https://misaac.me">Isaac on DevSecOps</a>
        </div>
            <div class="nav-navs">
                <ul>
                        
                            <li>
                                
                                
                                    <a class="nav-links no-hover-padding" href="https://misaac.me/blog/">
                                
                                blog
                                </a>
                            </li>
                        
                            <li>
                                
                                
                                    <a class="nav-links no-hover-padding" href="https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;miisaac&#x2F;" target="_blank" rel="noopener noreferrer">
                                
                                linkedin
                                </a>
                            </li>
                        
                            <li>
                                
                                
                                    <a class="nav-links no-hover-padding" href="https:&#x2F;&#x2F;github.com&#x2F;mbuotidem&#x2F;" target="_blank" rel="noopener noreferrer">
                                
                                github
                                </a>
                            </li>
                        
                            <li>
                                
                                
                                    <a class="nav-links no-hover-padding" href="https://misaac.me/tags/">
                                
                                tags
                                </a>
                            </li>
                        <div class="nav-navs" id="menu-icons-group">
                        

                        
                        

                        <li class="theme-switcher-wrapper js"><div
        title="Toggle dark&#x2F;light mode"
        class="theme-switcher"
        tabindex="0"
        role="button"
        aria-label="Toggle dark mode"
        aria-pressed="false">
    </div><div
        title="Reset mode to default"
        class="theme-resetter arrow"
        tabindex="0"
        role="button"
        aria-hidden="true"
        aria-label="Reset mode to default">
    </div>

</li>
</div>
                </ul>
            </div>
        
    </nav>
</header>

    <div class="content">

        
        




<main>
    <article>
        <h1 class="article-title">
            Connecting GitHub Codespaces to AWS VPN via SPIFFE&#x2F;SPIRE &amp; IAM Roles Anywhere
        </h1>

        <ul class="meta">
                <li>19th May 2025</li>
                <li title="399 words"><span class='separator' aria-hidden='true'>•</span>2 min read</li><li class="tag"><span class='separator' aria-hidden='true'>•</span>Tags:&nbsp;</li><li class="tag"><a href="https://misaac.me/tags/spiffe-spire/">spiffe&#x2F;spire</a>,&nbsp;</li><li class="tag"><a href="https://misaac.me/tags/identity/">identity</a>,&nbsp;</li><li class="tag"><a href="https://misaac.me/tags/secrets-management/">secrets management</a>,&nbsp;</li><li class="tag"><a href="https://misaac.me/tags/zero-trust/">zero trust</a>,&nbsp;</li><li class="tag"><a href="https://misaac.me/tags/aws/">aws</a>,&nbsp;</li><li class="tag"><a href="https://misaac.me/tags/codespaces/">codespaces</a>,&nbsp;</li><li class="tag"><a href="https://misaac.me/tags/iam/">iam</a>,&nbsp;</li><li class="tag"><a href="https://misaac.me/tags/vpn/">vpn</a>,&nbsp;</li><li class="tag"><a href="https://misaac.me/tags/terraform/">terraform</a>,&nbsp;</li><li class="tag"><a href="https://misaac.me/tags/github/">github</a>,&nbsp;</li><li class="tag"><a href="https://misaac.me/tags/iac/">iac</a></li>
        </ul>

        <section class="body"><h2 id="preamble"><a class="header-anchor no-hover-padding" href="#preamble" aria-label="Anchor link for: preamble"><span class="link-icon" aria-hidden="true"></span></a>
Preamble</h2>
<p>In <a href="https://misaac.me/blog/grant-aws-access-to-codespaces-via-spiffe-spire-iam-roles-anywhere/">Grant AWS Access to GitHub Codespaces via SPIFFE/SPIRE &amp; IAM Roles Anywhere</a>, we setup a SPIRE Server and SPIRE Agent and successfully authenticated to AWS using a SPIRE issued certificate.</p>
<p>In this post, we'll be building on that work, with the goal of using the same certificate to authenticate to AWS Client VPN.</p>
<h3 id="prerequisites"><a class="header-anchor no-hover-padding" href="#prerequisites" aria-label="Anchor link for: prerequisites"><span class="link-icon" aria-hidden="true"></span></a>
Prerequisites</h3>
<ul>
<li>All the setup in the previous <a href="https://misaac.me/blog/grant-aws-access-to-codespaces-via-spiffe-spire-iam-roles-anywhere/">post</a></li>
<li>AWS resource that we'll be connecting to via the VPN, e.g. an EC2 instance</li>
</ul>
<h2 id="setup-the-vpn-server-certificate"><a class="header-anchor no-hover-padding" href="#setup-the-vpn-server-certificate" aria-label="Anchor link for: setup-the-vpn-server-certificate"><span class="link-icon" aria-hidden="true"></span></a>
Setup the VPN Server Certificate</h2>
<p>This builds off the PKI we built in <a href="http://misaac.me/blog/grant-aws-access-to-codespaces-via-spiffe-spire-iam-roles-anywhere/#setting-up-our-public-key-infrastructure-pki">Setting up our Public Key Infrastructure</a>. We create a certificate signing request for our vpn server and have it signed by our Root CA. Then we add said certificate to AWS ACM so that we can reference it later when we setup our AWS Cient VPN endpoint.</p>
<pre class="z-code"><code><span class="z-text z-plain"># 3. VPN Server Private Key
</span><span class="z-text z-plain">resource &quot;tls_private_key&quot; &quot;vpn_server_key&quot; {
</span><span class="z-text z-plain">  algorithm = &quot;RSA&quot;
</span><span class="z-text z-plain">  rsa_bits  = 2048
</span><span class="z-text z-plain">}
</span><span class="z-text z-plain">
</span><span class="z-text z-plain"># 4. VPN Server Certificate Signing Request (CSR)
</span><span class="z-text z-plain">resource &quot;tls_cert_request&quot; &quot;vpn_server_csr&quot; {
</span><span class="z-text z-plain">  private_key_pem = tls_private_key.vpn_server_key.private_key_pem
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">  subject {
</span><span class="z-text z-plain">    common_name  = &quot;vpn.misaac.me&quot;
</span><span class="z-text z-plain">    organization = &quot;Misaac Org&quot;
</span><span class="z-text z-plain">    country      = &quot;US&quot;
</span><span class="z-text z-plain">  }
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">  dns_names = [&quot;vpn.misaac.me&quot;]
</span><span class="z-text z-plain">}
</span><span class="z-text z-plain">
</span><span class="z-text z-plain"># 5. Root CA Signs VPN Server Certificate (leaf cert)
</span><span class="z-text z-plain">resource &quot;tls_locally_signed_cert&quot; &quot;vpn_server_cert&quot; {
</span><span class="z-text z-plain">  cert_request_pem   = tls_cert_request.vpn_server_csr.cert_request_pem
</span><span class="z-text z-plain">  ca_private_key_pem = tls_private_key.root_ca_key.private_key_pem
</span><span class="z-text z-plain">  ca_cert_pem        = tls_self_signed_cert.root_ca_cert.cert_pem
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">  validity_period_hours = 8760 # 1 year
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">  allowed_uses = [
</span><span class="z-text z-plain">    &quot;server_auth&quot;,
</span><span class="z-text z-plain">    &quot;client_auth&quot;,
</span><span class="z-text z-plain">    &quot;digital_signature&quot;,
</span><span class="z-text z-plain">    &quot;key_encipherment&quot;,
</span><span class="z-text z-plain">  ]
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">  is_ca_certificate = false # It&#39;s a leaf cert (not a CA)
</span><span class="z-text z-plain">}
</span><span class="z-text z-plain">
</span><span class="z-text z-plain"># 6. Upload VPN Server Certificate (and chain) to ACM
</span><span class="z-text z-plain">resource &quot;aws_acm_certificate&quot; &quot;vpn_server_cert&quot; {
</span><span class="z-text z-plain">  private_key       = tls_private_key.vpn_server_key.private_key_pem
</span><span class="z-text z-plain">  certificate_body  = tls_locally_signed_cert.vpn_server_cert.cert_pem
</span><span class="z-text z-plain">  certificate_chain = tls_self_signed_cert.root_ca_cert.cert_pem
</span><span class="z-text z-plain">}
</span></code></pre>
<br>
<h2 id="setup-our-client-certificate-svid"><a class="header-anchor no-hover-padding" href="#setup-our-client-certificate-svid" aria-label="Anchor link for: setup-our-client-certificate-svid"><span class="link-icon" aria-hidden="true"></span></a>
Setup our Client Certificate (SVID)</h2>
<p>As we have the SPIRE agent setup from our work in the previous post, all we need to do is request a certificate from it.</p>
<pre class="z-code"><code><span class="z-text z-plain">$ bin/spire-agent api fetch x509 -write /tmp/          
</span><span class="z-text z-plain">Received 1 svid after 254.053709ms
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">SPIFFE ID:              spiffe://misaac.me/myservice
</span><span class="z-text z-plain">SVID Valid After:       2025-05-19 11:06:54 +0000 UTC
</span><span class="z-text z-plain">SVID Valid Until:       2025-05-19 12:07:04 +0000 UTC
</span><span class="z-text z-plain">Intermediate #1 Valid After:    2025-05-18 21:04:32 +0000 UTC
</span><span class="z-text z-plain">Intermediate #1 Valid Until:    2025-05-19 21:04:42 +0000 UTC
</span><span class="z-text z-plain">CA #1 Valid After:      2025-04-29 01:29:07 +0000 UTC
</span><span class="z-text z-plain">CA #1 Valid Until:      2035-04-27 01:29:07 +0000 UTC
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Writing SVID #0 to file /tmp/svid.0.pem.
</span><span class="z-text z-plain">Writing key #0 to file /tmp/svid.0.key.
</span><span class="z-text z-plain">Writing bundle #0 to file /tmp/bundle.0.pem.
</span><span class="z-text z-plain">
</span></code></pre>
<br>
<h2 id="setting-up-client-vpn"><a class="header-anchor no-hover-padding" href="#setting-up-client-vpn" aria-label="Anchor link for: setting-up-client-vpn"><span class="link-icon" aria-hidden="true"></span></a>
Setting up Client VPN</h2>

<p>To setup an AWS Client VPN endpoint, we need to :</p>
<ul>
<li>Set up logging</li>
<li>Add a security group rule to allow access to your target resource</li>
<li>Create the VPN endpoint</li>
<li>Associate a target network</li>
<li>Add an authorization rule</li>
</ul>
<h3 id="setting-up-logging">Setting up logging</h3>
<p>Connection logging records client connection requests, outcomes (success or failure), failure reasons, and client
termination time. Since we care about security, this observability is something we want to have.</p>
<pre class="z-code"><code><span class="z-text z-plain">resource &quot;aws_cloudwatch_log_group&quot; &quot;client_vpn&quot; {
</span><span class="z-text z-plain">name = &quot;aws-client-vpn-logs&quot;
</span><span class="z-text z-plain">}
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">resource &quot;aws_cloudwatch_log_stream&quot; &quot;client_vpn&quot; {
</span><span class="z-text z-plain">name = &quot;aws-client-vpn&quot;
</span><span class="z-text z-plain">log_group_name = aws_cloudwatch_log_group.client_vpn.name
</span><span class="z-text z-plain">}
</span></code></pre>
<h3 id="add-a-security-group-rule-to-allow-access-to-your-target-resource">Add a security group rule to allow access to your target resource</h3>
<p>If you create an AWS Client VPN endpoint without specifiying a security group, the VPC's default security group is
automatically applied to it.</p>
<p>AWS strongly recommends that default security groups restrict all inbound and outbound traffic, even though they cannot
be deleted. This is because inadvertently assigning a new AWS resource to the default security group can lead to
unauthorized access if it has open rules.</p>
<p>If your are following this best practice (which you should), you'll need to create a security group/security group rule
to allow access from the VPN to your target resource. Adjust the ingress rules (port, protocol) based on the resource
you need to access (e.g., port 5432 for PostgreSQL).</p>
<pre class="z-code"><code><span class="z-text z-plain">resource &quot;aws_security_group&quot; &quot;allow_ssh&quot; {
</span><span class="z-text z-plain">name = &quot;allow_ssh&quot;
</span><span class="z-text z-plain">description = &quot;Allow SSH inbound traffic and all outbound traffic&quot;
</span><span class="z-text z-plain">vpc_id = aws_vpc.main.id
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">tags = {
</span><span class="z-text z-plain">Name = &quot;allow_ssh&quot;
</span><span class="z-text z-plain">}
</span><span class="z-text z-plain">}
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">resource &quot;aws_vpc_security_group_ingress_rule&quot; &quot;allow_ssh_ipv4&quot; {
</span><span class="z-text z-plain">security_group_id = aws_security_group.allow_ssh.id
</span><span class="z-text z-plain">cidr_ipv4 = aws_vpc.main.cidr_block
</span><span class="z-text z-plain">from_port = 22
</span><span class="z-text z-plain">ip_protocol = &quot;tcp&quot;
</span><span class="z-text z-plain">to_port = 22
</span><span class="z-text z-plain">}
</span><span class="z-text z-plain">resource &quot;aws_vpc_security_group_egress_rule&quot; &quot;allow_all_traffic_ipv4&quot; {
</span><span class="z-text z-plain">security_group_id = aws_security_group.allow_ssh.id
</span><span class="z-text z-plain">cidr_ipv4 = &quot;0.0.0.0/0&quot;
</span><span class="z-text z-plain">ip_protocol = &quot;-1&quot; # semantically equivalent to all ports
</span><span class="z-text z-plain">}
</span></code></pre>
<br>
<h3 id="create-the-client-vpn-endpoint">Create the Client VPN Endpoint</h3>
<p>This is the central resource you create and manage to enable secure connections between your remote users and your AWS
resources. It acts as the termination point for all client VPN sessions.</p>
<blockquote>
<p><strong>Note:</strong>
Take care to select a cidr range for your vpn endpoint that does not clash with the cidr range of your VPC.</p>
</blockquote>
<pre class="z-code"><code><span class="z-text z-plain">resource &quot;aws_ec2_client_vpn_endpoint&quot; &quot;org&quot; {
</span><span class="z-text z-plain">description = &quot;misaac.me VPN&quot;
</span><span class="z-text z-plain">server_certificate_arn = aws_acm_certificate.vpncert.arn
</span><span class="z-text z-plain">client_cidr_block = &quot;172.16.0.0/16&quot;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">authentication_options {
</span><span class="z-text z-plain">type = &quot;certificate-authentication&quot;
</span><span class="z-text z-plain">root_certificate_chain_arn = aws_acm_certificate.vpncert.arn
</span><span class="z-text z-plain">}
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">connection_log_options {
</span><span class="z-text z-plain">enabled = true
</span><span class="z-text z-plain">cloudwatch_log_group = aws_cloudwatch_log_group.client_vpn.name
</span><span class="z-text z-plain">cloudwatch_log_stream = aws_cloudwatch_log_stream.client_vpn.name
</span><span class="z-text z-plain">}
</span><span class="z-text z-plain">split_tunnel = true
</span><span class="z-text z-plain">vpc_id = aws_vpc.main.id
</span><span class="z-text z-plain">security_group_ids = [aws_security_group.allow_ssh.id]
</span><span class="z-text z-plain">}
</span></code></pre>
<p>Notice how we reference the server certificate issued which we previously imported into ACM — in both
<code>server_certificate_arn</code> and <code>root_certificate_chain_arn</code>.</p>
<p>Since our client certificates will also be issued by the same CA, we can use the same certificate ARN as
the trust anchor for both server and client authentication. This allows any client certificate signed by the same CA to
be accepted during mutual TLS authentication.</p>
<p>We're also setting <code>split_tunnel</code> to <code>true</code>. This ensures that only traffic destined for resources inside the VPN is
routed through the VPN tunnel, while all other internet traffic continues to go through the user's local network.</p>
<p>If we left <code>split_tunnel</code> set to its default value of <code>false</code>, all traffic—including internet-bound requests—would be
routed through the VPN. Because the our fully-private VPC has no public internet access, this would effectively break
the user's connection, blackholing their traffic the moment they connect.</p>
<p>If you're reading this and you intend to set this up with an internet-connected vpc, note that <code>split_tunnel</code> might
still be useful for you if your security posture allows and you'd like to save on data transfer costs by only routing
AWS-bound traffic through the VPN.</p>
<h3 id="associate-the-vpn-endpoint-with-the-vpc-and-subnet">Associate the VPN endpoint with the VPC and subnet</h3>
<p>To route VPN traffic into your VPC, you need to associate the endpoint with a <strong>target network</strong> — which is just a
subnet in your VPC. This tells AWS where to send traffic from connected clients.</p>
<pre class="z-code"><code><span class="z-text z-plain">resource &quot;aws_ec2_client_vpn_network_association&quot; &quot;subnet_b&quot; {
</span><span class="z-text z-plain">client_vpn_endpoint_id = aws_ec2_client_vpn_endpoint.org.id
</span><span class="z-text z-plain">subnet_id = aws_subnet.subnet_b.id
</span><span class="z-text z-plain">}
</span></code></pre>
<h3 id="add-an-authorization-rule-for-the-vpc">Add an authorization rule for the VPC</h3>
<p>Even after associating a subnet, clients can’t access anything yet — you need to explicitly allow it with an
authorization rule.</p>
<pre class="z-code"><code><span class="z-text z-plain">resource &quot;aws_ec2_client_vpn_authorization_rule&quot; &quot;subnet_b&quot; {
</span><span class="z-text z-plain">client_vpn_endpoint_id = aws_ec2_client_vpn_endpoint.org.id
</span><span class="z-text z-plain">target_network_cidr = aws_vpc.main.cidr_block
</span><span class="z-text z-plain">authorize_all_groups = true
</span><span class="z-text z-plain">}
</span></code></pre>
<br>
<h2 id="connecting-to-client-vpn">Connecting to Client VPN</h2>
<p>To connect to the Client VPN, we'll need both the Client VPN endpoint configuration file and our generated client key
and certificate.</p>
<h3 id="prepare-the-client-vpn-endpoint-configuration-file">Prepare the Client VPN endpoint configuration file</h3>
<ol>
<li>
<p>Open the Amazon VPC console at <a href="https://console.aws.amazon.com/vpc/">https://console.aws.amazon.com/vpc/</a></p>
</li>
<li>
<p>In the navigation pane, choose <strong>Client VPN Endpoints</strong>.</p>
</li>
<li>
<p>Select the Client VPN endpoint that was just created, and choose <strong>Download client configuration</strong>.</p>
</li>
<li>
<p>Open the Client VPN endpoint configuration file using your preferred text editor. Add <code>&lt;cert&gt;&lt;/cert&gt;</code> and <code>&lt;key&gt; &lt;/key&gt;</code> tags to the file. Place the contents of the client certificate and the contents of the private key between the
corresponding tags, as such:</p>
</li>
</ol>
<pre class="z-code"><code><span class="z-text z-plain">&lt;cert&gt;
</span><span class="z-text z-plain">path to client certificate (.crt) file
</span><span class="z-text z-plain">&lt;/cert&gt;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">&lt;key&gt;
</span><span class="z-text z-plain">path to private key (.key) file
</span><span class="z-text z-plain">&lt;/key&gt;
</span></code></pre>
<ol>
<li>
<p>Save and close the Client VPN endpoint configuration file.</p>
</li>
<li>
<p>Add the line <code>pull-filter ignore "redirect-gateway"</code> to the ovpn file.</p>
</li>
</ol>
<blockquote>
<p><strong>Note:</strong> Step 6 deserves a bit of explanation. During testing on a local device using the AWS-provided VPN client, I
found that AWS Client VPN was still routing all traffic through the VPN—even though <code>split_tunnel</code> was enabled. The
culprit was the <code>redirect-gateway</code> flag which the AWS provided client was setting.</p>
<p>Fortunately, <code>pull-filter</code> is one of the supported <a href="https://docs.aws.amazon.com/vpn/latest/clientvpn-user/connect-aws-client-vpn-connect.html#support-openvpn">OpenVPN
directives</a>
in the AWS client. By adding <code>pull-filter ignore "redirect-gateway"</code>, we instruct the client to ignore that directive
and preserve split-tunnel behavior.</p>
</blockquote>
<h3 id="connect-to-the-client-vpn-endpoint">Connect to the Client VPN endpoint</h3>
<p>How you'll connect to the VPN depends on your OS as well as your VPN client. AWS provides its own <a href="https://docs.aws.amazon.com/vpn/latest/clientvpn-user/user-getting-started.html#install-client">custom OpenVPN
client</a> that is designed
to be compatible with all features of AWS Client VPN. However, since the goal was to use this in an Ubuntu Linux GitHub
Codespace, we'll just use the bog standard OpenVPN client.</p>
<p>First we'll install openvpn.</p>
<pre class="z-code"><code><span class="z-text z-plain">sudo apt-get update &amp;&amp; sudo apt-get install openvpn
</span></code></pre>
<p>Then we can connect using:</p>
<pre class="z-code"><code><span class="z-text z-plain">sudo openvpn --config /path/to/config/file
</span></code></pre>
<p>If all went well, you should see this:</p>
<pre class="z-code"><code><span class="z-text z-plain">@mbuotidem ➜ /workspaces/mbuotidem.github.io (main) $ sudo openvpn --config o.ovpn
</span><span class="z-text z-plain">Mon May 19 00:40:17 2025 OpenVPN 2.4.12 x86_64-pc-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO]
</span><span class="z-text z-plain">[AEAD] built on Jun 27 2024
</span><span class="z-text z-plain">Mon May 19 00:40:17 2025 library versions: OpenSSL 1.1.1f 31 Mar 2020, LZO 2.10
</span><span class="z-text z-plain">Mon May 19 00:40:17 2025 TCP/UDP: Preserving recently used remote address: [AF_INET]3.XXX.XXX.72:443
</span><span class="z-text z-plain">Mon May 19 00:40:17 2025 Socket Buffers: R=[1048576-&gt;1048576] S=[212992-&gt;212992]
</span><span class="z-text z-plain">...
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Mon May 19 00:40:19 2025 Outgoing Data Channel: Cipher &#39;AES-256-GCM&#39; initialized with 256 bit key
</span><span class="z-text z-plain">Mon May 19 00:40:19 2025 Incoming Data Channel: Cipher &#39;AES-256-GCM&#39; initialized with 256 bit key
</span><span class="z-text z-plain">Mon May 19 00:40:19 2025 ROUTE_GATEWAY 10.0.0.1/255.255.0.0 IFACE=eth0 HWADDR=7c:1e:52:5b:bf:9b
</span><span class="z-text z-plain">Mon May 19 00:40:19 2025 TUN/TAP device tun0 opened
</span><span class="z-text z-plain">Mon May 19 00:40:19 2025 TUN/TAP TX queue length set to 100
</span><span class="z-text z-plain">Mon May 19 00:40:19 2025 /sbin/ip link set dev tun0 up mtu 1500
</span><span class="z-text z-plain">Mon May 19 00:40:19 2025 /sbin/ip addr add dev tun0 172.16.0.13/27 broadcast 172.16.0.31
</span><span class="z-text z-plain">Mon May 19 00:40:19 2025 /sbin/ip route add 172.31.0.0/16 via 172.16.0.1
</span><span class="z-text z-plain">Mon May 19 00:40:19 2025 Initialization Sequence Completed
</span></code></pre>
<p>You can now leave that terminal window running, open a new one, and ssh, curl, or otherwise connect to the resource in your private subnet!</p>
<p>On the AWS Side, you can see the connection info if you visit your VPN endpoint's info page. Notice how our common name shows up, indicating we're connected using a certificate.</p>
<p><img src="https://misaac.me/blog/connecting-github-codespaces-to-aws-vpn-via-spiffe-spire-and-iam-roles-anywhere/vpn-via-spire-svid.png" alt="Image showing an active AWS Client VPN connection with identifiers such as the x.509 certificate common name" /></p>
<h2 id="wrapping-up"><a class="header-anchor no-hover-padding" href="#wrapping-up" aria-label="Anchor link for: wrapping-up"><span class="link-icon" aria-hidden="true"></span></a>
Wrapping Up</h2>
<p>That’s it! You've now used your SPIRE issued SVID twice, first to <a href="http://misaac.me/blog/grant-aws-access-to-codespaces-via-spiffe-spire-iam-roles-anywhere/#use-a-spiffe-svid-to-obtain-aws-credentials-via-iam-roles-anywhere">grab</a> AWS credentials, via AWS IAM Anywhere, and now, to connect to AWS Client VPN.</p>
<p>In our next post, we'll move beyond the local developer machine context and explore using SPIFFE/SPIRE to grant Kubernetes clusters not running on AWS access to AWS API's vi IAM Roles Anywhere.</p>

        </section>

        
                
                
                    
                        
                        
                        
                    
                    
                        
                        
                        
                    
                
                
            <nav class="full-width article-navigation">
                <div><a href="https://misaac.me/blog/automated-aws-credential-renewal-spiffe-helper-roles-anywhere/" aria-label="Next" aria-describedby="left_title"><span class="arrow">←</span>&nbsp;Next</a>
                <p aria-hidden="true" id="left_title">Automated AWS Credential Renewal Using SPIFFE Helper and IAM Roles Anywhere</p></div>
                <div><a href="https://misaac.me/blog/grant-aws-access-to-codespaces-via-spiffe-spire-iam-roles-anywhere/" aria-label="Prev" aria-describedby="right_title">Prev&nbsp;<span class="arrow">→</span></a>
                <p aria-hidden="true" id="right_title">Grant AWS Access to GitHub Codespaces via SPIFFE&#x2F;SPIRE &amp; IAM Roles Anywhere</p></div>
            </nav>
        
        

        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
        

    </article>
</main>

    <div id="button-container">
        
        
            <div id="toc-floating-container">
                <input type="checkbox" id="toc-toggle" class="toggle"/>
                <label for="toc-toggle" class="overlay"></label>
                <label for="toc-toggle" id="toc-button" class="button" title="Toggle Table of Contents">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M414.82-193.094q-18.044 0-30.497-12.32-12.453-12.319-12.453-30.036t12.453-30.086q12.453-12.37 30.497-12.37h392.767q17.237 0 29.927 12.487 12.69 12.486 12.69 30.203 0 17.716-12.69 29.919t-29.927 12.203H414.82Zm0-244.833q-18.044 0-30.497-12.487Q371.87-462.9 371.87-480.45t12.453-29.92q12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.511 12.69 12.512 12.69 29.845 0 17.716-12.69 30.086-12.69 12.37-29.927 12.37H414.82Zm0-245.167q-18.044 0-30.497-12.32t-12.453-30.037q0-17.716 12.453-30.086 12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.486 12.69 12.487 12.69 30.203 0 17.717-12.69 29.92-12.69 12.203-29.927 12.203H414.82ZM189.379-156.681q-32.652 0-55.878-22.829t-23.226-55.731q0-32.549 23.15-55.647 23.151-23.097 55.95-23.097 32.799 0 55.313 23.484 22.515 23.484 22.515 56.246 0 32.212-22.861 54.893-22.861 22.681-54.963 22.681Zm0-245.167q-32.652 0-55.878-23.134-23.226-23.135-23.226-55.623 0-32.487 23.467-55.517t56.12-23.03q32.102 0 54.721 23.288 22.62 23.288 22.62 55.775 0 32.488-22.861 55.364-22.861 22.877-54.963 22.877Zm-.82-244.833q-32.224 0-55.254-23.288-23.03-23.289-23.03-55.623 0-32.333 23.271-55.364 23.272-23.03 55.495-23.03 32.224 0 55.193 23.288 22.969 23.289 22.969 55.622 0 32.334-23.21 55.364-23.21 23.031-55.434 23.031Z"/></svg>
                </label>
                <div class="toc-content">
                    

<div class="toc-container">
    

    <ul>
        
            
            
                <li><a href="https://misaac.me/blog/connecting-github-codespaces-to-aws-vpn-via-spiffe-spire-and-iam-roles-anywhere/#preamble">Preamble</a>
                    
                        <ul>
                            
                                
                                    <li><a href="https://misaac.me/blog/connecting-github-codespaces-to-aws-vpn-via-spiffe-spire-and-iam-roles-anywhere/#prerequisites">Prerequisites</a>
                                        
                                    </li>
                                
                            
                        </ul>
                    
                </li>
            
        
            
            
                <li><a href="https://misaac.me/blog/connecting-github-codespaces-to-aws-vpn-via-spiffe-spire-and-iam-roles-anywhere/#setup-the-vpn-server-certificate">Setup the VPN Server Certificate</a>
                    
                </li>
            
        
            
            
                <li><a href="https://misaac.me/blog/connecting-github-codespaces-to-aws-vpn-via-spiffe-spire-and-iam-roles-anywhere/#setup-our-client-certificate-svid">Setup our Client Certificate (SVID)</a>
                    
                </li>
            
        
            
            
                <li><a href="https://misaac.me/blog/connecting-github-codespaces-to-aws-vpn-via-spiffe-spire-and-iam-roles-anywhere/#setting-up-client-vpn">Setting up Client VPN</a>
                    
                </li>
            
        
            
            
                <li><a href="https://misaac.me/blog/connecting-github-codespaces-to-aws-vpn-via-spiffe-spire-and-iam-roles-anywhere/#wrapping-up">Wrapping Up</a>
                    
                </li>
            
        
    </ul>
</div>


                </div>
            </div>
        

        
        

        
        <a href="#" id="top-button" class="no-hover-padding" title="Go to the top of the page">
            <svg viewBox="0 0 20 20" fill="currentColor"><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg>
        </a>
    </div>


<span id="copy-success" class="hidden">
        Copied!
    </span>
    <span id="copy-init" class="hidden">
        Copy code to clipboard
    </span>
    <script defer src="https://misaac.me/js/copyCodeToClipboard.min.js"></script>
    </div>
    <footer>
    <section>
        <nav class="socials nav-navs">
        </nav>

        
        <nav class="nav-navs">
        </nav>

        <div class="credits">
            <small>
                
    
    
    
    
        
    
        
    

    

    
    
    

    
    
    <p><p>© 2025 Isaac M • Except where otherwise noted , content on this site is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> license.</p>
</p>

                </small>
        </div>
    </section>

    </footer>

</body>

</html>
